<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VetScan Pro 3000 - Professional Edition</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        @keyframes slideIn {
            from { transform: translateX(-100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        @keyframes glow {
            0%, 100% { box-shadow: 0 0 5px currentColor; }
            50% { box-shadow: 0 0 20px currentColor, 0 0 30px currentColor; }
        }
        .animate-pulse {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
        .animate-spin {
            animation: spin 1s linear infinite;
        }
        .slide-in {
            animation: slideIn 0.5s ease-out;
        }
        .glow {
            animation: glow 2s ease-in-out infinite;
        }
        .urgency-critical {
            animation: pulse 0.5s ease-in-out infinite;
            border-color: #ef4444;
        }
        .tooltip {
            visibility: hidden;
            opacity: 0;
            transition: opacity 0.3s;
        }
        .tooltip-trigger:hover .tooltip {
            visibility: visible;
            opacity: 1;
        }
    </style>
</head>
<body class="bg-gray-950 text-cyan-300 font-mono">
    <div id="root" class="min-h-screen">
        <!-- Loading Screen -->
        <div class="flex items-center justify-center min-h-screen">
            <div class="text-center">
                <div class="animate-spin text-cyan-400 text-6xl mb-4">⚙</div>
                <p class="text-xl">VetScan Pro 3000 Professional lädt...</p>
                <p class="text-sm text-cyan-600 mt-2">Veterinärmedizinische Datenbank wird initialisiert...</p>
            </div>
        </div>
    </div>

    <script>
        // ============================================
        // MEDIZINISCH KORREKTE DATENBASIS
        // ============================================
        
        const vitalNormalRanges = {
            hund: {
                heartRate: { min: 70, max: 120, unit: 'BPM', description: 'Kleine Rassen: 100-120, Große: 70-100' },
                temperature: { min: 37.8, max: 39.2, unit: '°C', description: 'Rektal gemessen' },
                bloodPressure: { min: 110, max: 160, unit: 'mmHg', description: 'Systolisch' },
                oxygenLevel: { min: 95, max: 100, unit: '%', description: 'SpO₂' },
                respirationRate: { min: 10, max: 30, unit: '/min', description: 'In Ruhe' },
                bloodGlucose: { min: 80, max: 120, unit: 'mg/dl', description: 'Nüchtern' }
            },
            katze: {
                heartRate: { min: 140, max: 220, unit: 'BPM', description: 'Ruhe: 160-180' },
                temperature: { min: 38.1, max: 39.2, unit: '°C', description: 'Rektal' },
                bloodPressure: { min: 120, max: 170, unit: 'mmHg', description: 'Systolisch' },
                oxygenLevel: { min: 95, max: 100, unit: '%', description: 'SpO₂' },
                respirationRate: { min: 20, max: 30, unit: '/min', description: 'Bis 40 normal' },
                bloodGlucose: { min: 80, max: 120, unit: 'mg/dl', description: 'Nüchtern' }
            },
            pferd: {
                heartRate: { min: 28, max: 44, unit: 'BPM', description: 'Ø 32-42' },
                temperature: { min: 37.2, max: 38.3, unit: '°C', description: 'Rektal' },
                bloodPressure: { min: 120, max: 180, unit: 'mmHg', description: 'Systolisch' },
                oxygenLevel: { min: 95, max: 100, unit: '%', description: 'SpO₂' },
                respirationRate: { min: 8, max: 16, unit: '/min', description: 'In Ruhe' },
                bloodGlucose: { min: 70, max: 135, unit: 'mg/dl', description: 'Nüchtern' }
            },
            kaninchen: {
                heartRate: { min: 180, max: 250, unit: 'BPM', description: 'Bis 325 bei Stress' },
                temperature: { min: 38.5, max: 40.0, unit: '°C', description: 'Rektal' },
                bloodPressure: { min: 75, max: 134, unit: 'mmHg', description: 'Systolisch' },
                oxygenLevel: { min: 95, max: 100, unit: '%', description: 'SpO₂' },
                respirationRate: { min: 30, max: 60, unit: '/min', description: 'Bis 100 bei Stress' },
                bloodGlucose: { min: 75, max: 155, unit: 'mg/dl', description: 'Nüchtern' }
            }
        };

        // ============================================
        // TIERARTSPEZIFISCHE KRANKHEITEN - WISSENSCHAFTLICH KORREKT
        // ============================================
        
        const diseasesByAnimal = {
            hund: {
                gdv: {
                    name: "Magendrehung (GDV)",
                    urgency: "NOTFALL",
                    icon: "🚨",
                    prevalence: "Große Rassen: 23% Lebenszeitrisiko",
                    vitalChanges: {
                        heartRate: { modifier: 2.0, variance: 0.3 },
                        bloodPressure: { modifier: 0.6, variance: 0.1 },
                        temperature: { modifier: 1.15, variance: 0.05 },
                        respirationRate: { modifier: 1.8, variance: 0.2 },
                        oxygenLevel: { modifier: 0.85, variance: 0.05 },
                        bloodGlucose: { modifier: 1.5, variance: 0.2 }
                    },
                    vetAnalysis: {
                        diagnosis: "270° Torsion im Uhrzeigersinn. Magendilatation mit Gasakkumulation. Milztorsion sekundär.",
                        labValues: "Laktat: 8.2 mmol/L (Ref: <2.5), pH: 7.1 (metabolische Azidose), Hämatokrit: 55%",
                        treatment: "SOFORT: 1) Schocklagerung 2) IV-Zugänge 3) Kristalloide 90ml/kg/h 4) Trokarisierung 5) OP",
                        medication: "Lidocain-CRI 50μg/kg/min, Metoclopramid 0.5mg/kg, Maropitant 1mg/kg",
                        prognosis: "Ohne OP: 0% Überlebenschance. Mit OP <6h: 85% Erfolg."
                    },
                    assistantExplanation: {
                        whatHappened: "Der Magen hat sich wie ein Luftballon aufgebläht und verdreht - wie ein abgeknickter Gartenschlauch.",
                        whyDangerous: "Der verdrehte Magen drückt auf alle Organe. Der Hund kann in 1-2 Stunden sterben!",
                        whatToDo: [
                            "SOFORT Tierarzt anrufen - jede Minute zählt!",
                            "Vorderbeine erhöht lagern",
                            "KEIN Wasser geben",
                            "Beruhigend auf Hund einreden"
                        ],
                        prevention: "Große Hunde nicht nach dem Fressen toben lassen. Anti-Schling-Napf verwenden."
                    }
                },
                parvovirose: {
                    name: "Parvovirose",
                    urgency: "NOTFALL",
                    icon: "🦠",
                    prevalence: "Welpen: 10% Inzidenz ohne Impfung",
                    vitalChanges: {
                        heartRate: { modifier: 1.5, variance: 0.2 },
                        bloodPressure: { modifier: 0.7, variance: 0.1 },
                        temperature: { modifier: 1.2, variance: 0.1 },
                        respirationRate: { modifier: 1.3, variance: 0.1 },
                        oxygenLevel: { modifier: 0.9, variance: 0.05 },
                        bloodGlucose: { modifier: 0.7, variance: 0.2 }
                    },
                    vetAnalysis: {
                        diagnosis: "Canine Parvovirus Typ 2. Hämorrhagische Gastroenteritis. Leukopenie.",
                        labValues: "Leukozyten: 2.000/μl (Ref: 6.000-17.000), Hämatokrit: 55%, Albumin: 1.8 g/dl",
                        treatment: "Isolation! IV-Flüssigkeit, Antiemetika, Antibiotika, Plasmatransfusion",
                        medication: "Maropitant 1mg/kg, Ampicillin 22mg/kg TID, Metronidazol 15mg/kg BID",
                        prognosis: "Mit intensiver Therapie: 70-90% Überlebensrate. Ohne: <10%"
                    },
                    assistantExplanation: {
                        whatHappened: "Ein sehr ansteckendes Virus greift den Darm an. Der Welpe verliert viel Flüssigkeit.",
                        whyDangerous: "Extremer Durchfall führt zu Austrocknung. Das Immunsystem bricht zusammen.",
                        whatToDo: [
                            "SOFORT isolieren von anderen Hunden!",
                            "Tierarzt-Notfall!",
                            "Alles desinfizieren mit Bleiche",
                            "Keine anderen Welpen in Kontakt bringen"
                        ],
                        prevention: "IMPFUNG! Grundimmunisierung ab 8. Woche ist lebenswichtig!"
                    }
                },
                hd: {
                    name: "Hüftgelenksdysplasie (HD)",
                    urgency: "CHRONISCH",
                    icon: "🦴",
                    prevalence: "Große Rassen: bis 50% betroffen",
                    vitalChanges: {
                        heartRate: { modifier: 1.1, variance: 0.1 },
                        bloodPressure: { modifier: 1.1, variance: 0.05 },
                        temperature: { modifier: 1.0, variance: 0.02 },
                        respirationRate: { modifier: 1.1, variance: 0.05 },
                        oxygenLevel: { modifier: 1.0, variance: 0.01 },
                        bloodGlucose: { modifier: 1.0, variance: 0.05 }
                    },
                    vetAnalysis: {
                        diagnosis: "Subluxation beidseits. Norberg-Winkel 95° (normal >105°). Sekundäre Arthrose.",
                        labValues: "CRP erhöht, normale Blutwerte",
                        treatment: "Konservativ: Gewichtsreduktion, Physiotherapie. Chirurgisch: TPO, DPO, TEP",
                        medication: "Meloxicam 0.1mg/kg SID, Gabapentin 10mg/kg TID, Chondroprotektiva",
                        prognosis: "Mit Management: gute Lebensqualität. Ohne: progressive Arthrose"
                    },
                    assistantExplanation: {
                        whatHappened: "Die Hüftgelenke sind nicht richtig ausgebildet. Die Kugel passt nicht in die Pfanne.",
                        whyDangerous: "Führt zu Schmerzen, Lahmheit und Arthrose. Lebensqualität sinkt.",
                        whatToDo: [
                            "Gewicht reduzieren - jedes Kilo zählt!",
                            "Schwimmen statt Springen",
                            "Weiche Liegeplätze",
                            "Regelmäßige, moderate Bewegung"
                        ],
                        prevention: "Zuchtselektion! Nur HD-freie Elterntiere. Welpen nicht überbelasten."
                    }
                },
                diabetes_hund: {
                    name: "Diabetes mellitus",
                    urgency: "CHRONISCH",
                    icon: "💉",
                    prevalence: "0.3-1% aller Hunde",
                    vitalChanges: {
                        heartRate: { modifier: 1.2, variance: 0.1 },
                        bloodPressure: { modifier: 0.9, variance: 0.05 },
                        temperature: { modifier: 1.0, variance: 0.02 },
                        respirationRate: { modifier: 1.3, variance: 0.1 },
                        oxygenLevel: { modifier: 0.95, variance: 0.03 },
                        bloodGlucose: { modifier: 4.0, variance: 1.0 }
                    },
                    vetAnalysis: {
                        diagnosis: "Typ 1 Diabetes. Absolute Insulindefizienz. Beta-Zell-Destruktion.",
                        labValues: "Glukose: 428 mg/dl, Fruktosamin: 580 μmol/L, Ketonurie: +++",
                        treatment: "Insulintherapie: Caninsulin 0.5 IU/kg BID. Glukosekurve alle 2 Wochen.",
                        medication: "Langzeit-Insulin (Caninsulin/Prozinc), bei Ketoazidose: Regular Insulin CRI",
                        prognosis: "Mit guter Einstellung: normale Lebenserwartung"
                    },
                    assistantExplanation: {
                        whatHappened: "Die Bauchspeicheldrüse produziert kein Insulin mehr - der 'Schlüssel' für Zucker fehlt.",
                        whyDangerous: "Zu viel Zucker im Blut schädigt Organe. Ohne Insulin stirbt der Hund.",
                        whatToDo: [
                            "Insulin IMMER zur gleichen Zeit",
                            "Fütterung direkt nach Insulin",
                            "Blutzucker-Tagebuch führen",
                            "Notfall-Traubenzucker bereithalten"
                        ],
                        prevention: "Übergewicht vermeiden! Kastrierte Hündinnen haben höheres Risiko."
                    }
                },
                epilepsie: {
                    name: "Idiopathische Epilepsie",
                    urgency: "AKUT",
                    icon: "⚡",
                    prevalence: "0.5-5% aller Hunde",
                    vitalChanges: {
                        heartRate: { modifier: 1.8, variance: 0.3 },
                        bloodPressure: { modifier: 1.3, variance: 0.2 },
                        temperature: { modifier: 1.1, variance: 0.05 },
                        respirationRate: { modifier: 1.5, variance: 0.2 },
                        oxygenLevel: { modifier: 0.9, variance: 0.05 },
                        bloodGlucose: { modifier: 1.3, variance: 0.2 }
                    },
                    vetAnalysis: {
                        diagnosis: "Generalisierte tonisch-klonische Anfälle. Postiktale Phase 30min.",
                        labValues: "CK erhöht postiktal, Laktat erhöht, sonst unauffällig",
                        treatment: "Status epilepticus: Diazepam 0.5mg/kg IV. Dauermedikation wenn >1 Anfall/Monat",
                        medication: "Phenobarbital 2.5mg/kg BID, Kaliumbromid 40mg/kg/Tag, Levetiracetam",
                        prognosis: "Mit Medikation: 60-70% anfallsfrei, 20-30% reduzierte Anfälle"
                    },
                    assistantExplanation: {
                        whatHappened: "Das Gehirn hat einen 'Kurzschluss' - wie ein elektrisches Gewitter im Kopf.",
                        whyDangerous: "Lange Anfälle können das Gehirn schädigen. Verletzungsgefahr!",
                        whatToDo: [
                            "Während Anfall: NICHT festhalten!",
                            "Gegenstände wegräumen",
                            "Zeit stoppen",
                            "Nach 5 Minuten: NOTFALL!",
                            "Video für Tierarzt machen"
                        ],
                        prevention: "Trigger vermeiden: Stress, Schlafmangel, blinkende Lichter"
                    }
                },
                herzinsuffizienz: {
                    name: "Herzinsuffizienz (DCM/Mitralklappeninsuffizienz)",
                    urgency: "CHRONISCH",
                    icon: "❤️",
                    prevalence: "10% aller Hunde >10 Jahre",
                    vitalChanges: {
                        heartRate: { modifier: 1.4, variance: 0.2 },
                        bloodPressure: { modifier: 0.8, variance: 0.1 },
                        temperature: { modifier: 1.0, variance: 0.02 },
                        respirationRate: { modifier: 1.6, variance: 0.2 },
                        oxygenLevel: { modifier: 0.85, variance: 0.05 },
                        bloodGlucose: { modifier: 1.0, variance: 0.05 }
                    },
                    vetAnalysis: {
                        diagnosis: "Mitralklappeninsuffizienz Grad III/VI. LA/Ao-Ratio: 1.8. Lungenödem beginnend.",
                        labValues: "NT-proBNP: 2800 pmol/L (Ref: <900), Troponin I erhöht",
                        treatment: "ACE-Hemmer, Diuretika, Pimobendan. Salzarme Diät.",
                        medication: "Pimobendan 0.25mg/kg BID, Furosemid 2mg/kg BID, Enalapril 0.5mg/kg BID",
                        prognosis: "Stadium B2: Jahre. Stadium C: 6-24 Monate. Stadium D: Wochen-Monate"
                    },
                    assistantExplanation: {
                        whatHappened: "Das Herz pumpt nicht mehr richtig. Die Herzklappe schließt nicht mehr dicht.",
                        whyDangerous: "Wasser sammelt sich in der Lunge. Der Hund bekommt schlecht Luft.",
                        whatToDo: [
                            "Medikamente IMMER pünktlich",
                            "Wenig Salz im Futter",
                            "Kurze, ruhige Spaziergänge",
                            "Atemfrequenz in Ruhe zählen",
                            "Bei >30/min zum Tierarzt!"
                        ],
                        prevention: "Regelmäßige Herzuntersuchung ab 7 Jahren. Übergewicht vermeiden."
                    }
                }
            },
            
            katze: {
                flutd: {
                    name: "FLUTD (Harnröhrenobstruktion)",
                    urgency: "NOTFALL",
                    icon: "🚨",
                    prevalence: "0.5-1% aller Katzen/Jahr, Kater 3x häufiger",
                    vitalChanges: {
                        heartRate: { modifier: 1.4, variance: 0.1 },
                        bloodPressure: { modifier: 1.2, variance: 0.1 },
                        temperature: { modifier: 1.05, variance: 0.02 },
                        respirationRate: { modifier: 1.3, variance: 0.1 },
                        oxygenLevel: { modifier: 0.98, variance: 0.02 },
                        bloodGlucose: { modifier: 1.1, variance: 0.05 }
                    },
                    vetAnalysis: {
                        diagnosis: "Urethraobstruktion durch Struvitkristalle. Blasenwandverdickung 8mm. Azotämie.",
                        labValues: "Kreatinin: 5.2 mg/dl, Harnstoff: 180 mg/dl, K⁺: 6.8 mmol/L (Hyperkaliämie!)",
                        treatment: "Sofort: Katheterisierung unter Sedation. Blasenspülung. IV-Flüssigkeit.",
                        medication: "Buprenorphin 0.02mg/kg, Prazosin 0.5mg/kg, Meloxicam 0.05mg/kg",
                        prognosis: "Nach Deobstruktion gut. Re-Obstruktionsrate: 30% in 6 Monaten"
                    },
                    assistantExplanation: {
                        whatHappened: "Die Harnröhre ist durch Kristalle verstopft - wie Sand im Gartenschlauch.",
                        whyDangerous: "Die Blase kann platzen! Giftstoffe sammeln sich. Nach 48h Nierenversagen!",
                        whatToDo: [
                            "SOFORT zum Tierarzt - auch nachts!",
                            "Katze NICHT auf Blase drücken!",
                            "Transport in Transportbox",
                            "Letzte Urinabsatz notieren"
                        ],
                        prevention: "Viel Trinken! Mehrere Wasserstellen. Nassfutter. Stress reduzieren."
                    }
                },
                fip: {
                    name: "FIP (Feline Infektiöse Peritonitis)",
                    urgency: "DRINGEND",
                    icon: "🦠",
                    prevalence: "5-10% der FCoV-infizierten Katzen",
                    vitalChanges: {
                        heartRate: { modifier: 1.2, variance: 0.1 },
                        bloodPressure: { modifier: 0.9, variance: 0.05 },
                        temperature: { modifier: 1.15, variance: 0.1 },
                        respirationRate: { modifier: 1.2, variance: 0.1 },
                        oxygenLevel: { modifier: 0.95, variance: 0.03 },
                        bloodGlucose: { modifier: 1.0, variance: 0.05 }
                    },
                    vetAnalysis: {
                        diagnosis: "Feuchte Form: Aszites, Pleuralerguss. Trockene Form: Granulome in Organen.",
                        labValues: "Albumin/Globulin <0.4, Bilirubin erhöht, FCoV-Titer 1:1280",
                        treatment: "GS-441524 (Remdesivir-Analog) 10mg/kg SID für 84 Tage. Supportiv.",
                        medication: "GS-441524, Prednisolon 2mg/kg, Interferon, Supportivtherapie",
                        prognosis: "Mit GS-441524: 80-95% Heilung! Ohne: meist tödlich in Wochen"
                    },
                    assistantExplanation: {
                        whatHappened: "Ein harmloses Darmvirus ist mutiert und greift jetzt den ganzen Körper an.",
                        whyDangerous: "Flüssigkeit sammelt sich im Bauch. Organe entzünden sich.",
                        whatToDo: [
                            "Neue Medikamente verfügbar!",
                            "Behandlung 84 Tage durchhalten",
                            "Stress minimieren",
                            "Isolierung bei mehreren Katzen"
                        ],
                        prevention: "Stress reduzieren. Überbelegung vermeiden. FCoV-Test bei neuen Katzen."
                    }
                },
                cni: {
                    name: "Chronische Niereninsuffizienz (CNI)",
                    urgency: "CHRONISCH",
                    icon: "💧",
                    prevalence: "30-40% aller Katzen >15 Jahre",
                    vitalChanges: {
                        heartRate: { modifier: 1.1, variance: 0.05 },
                        bloodPressure: { modifier: 1.3, variance: 0.1 },
                        temperature: { modifier: 0.98, variance: 0.02 },
                        respirationRate: { modifier: 1.1, variance: 0.05 },
                        oxygenLevel: { modifier: 0.98, variance: 0.02 },
                        bloodGlucose: { modifier: 1.0, variance: 0.05 }
                    },
                    vetAnalysis: {
                        diagnosis: "IRIS Stadium III. Kreatinin 3.8 mg/dl. Proteinurie. Hypertension.",
                        labValues: "Kreatinin: 3.8 mg/dl, SDMA: 25 μg/dl, Phosphat: 6.2 mg/dl, Anämie",
                        treatment: "Nierendiät, Phosphatbinder, ACE-Hemmer, subkutane Infusionen",
                        medication: "Benazepril 0.5mg/kg SID, Phosphatbinder, EPO bei Anämie",
                        prognosis: "Stadium II: Jahre. Stadium III: 6-24 Monate. Stadium IV: Wochen-Monate"
                    },
                    assistantExplanation: {
                        whatHappened: "Die Nieren arbeiten nur noch teilweise - wie ein verstopfter Filter.",
                        whyDangerous: "Giftstoffe sammeln sich im Körper. Die Katze vergiftet sich selbst.",
                        whatToDo: [
                            "Spezial-Nierenfutter IMMER",
                            "Viel Trinken fördern",
                            "Regelmäßige Infusionen",
                            "Gewicht kontrollieren"
                        ],
                        prevention: "Früherkennung! Jährliche Blutuntersuchung ab 7 Jahren."
                    }
                },
                hyperthyreose: {
                    name: "Hyperthyreose",
                    urgency: "CHRONISCH",
                    icon: "🦋",
                    prevalence: "10% aller Katzen >10 Jahre",
                    vitalChanges: {
                        heartRate: { modifier: 1.6, variance: 0.2 },
                        bloodPressure: { modifier: 1.3, variance: 0.1 },
                        temperature: { modifier: 1.02, variance: 0.02 },
                        respirationRate: { modifier: 1.2, variance: 0.1 },
                        oxygenLevel: { modifier: 0.98, variance: 0.02 },
                        bloodGlucose: { modifier: 1.2, variance: 0.1 }
                    },
                    vetAnalysis: {
                        diagnosis: "Benigne Schilddrüsenhyperplasie. T4: 8.2 μg/dl (Ref: 0.8-4.0).",
                        labValues: "T4: 8.2 μg/dl, ALT erhöht, ALP erhöht, Herzfrequenz: 240/min",
                        treatment: "Thiamazol, Radiojodtherapie, Thyreoidektomie, jodreduzierte Diät",
                        medication: "Thiamazol 2.5mg BID initial, dann nach T4-Spiegel anpassen",
                        prognosis: "Mit Behandlung: exzellent. Ohne: Herzversagen, Nierenversagen"
                    },
                    assistantExplanation: {
                        whatHappened: "Die Schilddrüse arbeitet auf Hochtouren - wie ein Motor der immer Vollgas gibt.",
                        whyDangerous: "Das Herz rast ständig. Die Katze 'verbrennt' innerlich.",
                        whatToDo: [
                            "Tabletten TÄGLICH geben",
                            "Regelmäßige Blutkontrollen",
                            "Gewicht dokumentieren",
                            "Puls kontrollieren"
                        ],
                        prevention: "Nicht verhinderbar. Früherkennung durch jährliche T4-Bestimmung ab 7 Jahren."
                    }
                },
                diabetes_katze: {
                    name: "Diabetes mellitus",
                    urgency: "CHRONISCH",
                    icon: "💉",
                    prevalence: "0.5-2% aller Katzen",
                    vitalChanges: {
                        heartRate: { modifier: 1.1, variance: 0.05 },
                        bloodPressure: { modifier: 0.95, variance: 0.05 },
                        temperature: { modifier: 1.0, variance: 0.02 },
                        respirationRate: { modifier: 1.1, variance: 0.05 },
                        oxygenLevel: { modifier: 0.98, variance: 0.02 },
                        bloodGlucose: { modifier: 3.5, variance: 0.8 }
                    },
                    vetAnalysis: {
                        diagnosis: "Typ 2 Diabetes mit Insulinresistenz. Glukose 380 mg/dl.",
                        labValues: "Glukose: 380 mg/dl, Fruktosamin: 450 μmol/L, Ketonurie negativ",
                        treatment: "Insulin Glargin 0.5 IU/kg BID, Low-Carb-Diät, Gewichtsreduktion",
                        medication: "Lantus/Levemir 0.5 IU/kg BID, bei Remission ausschleichen",
                        prognosis: "30-90% Remissionschance bei früher Diagnose und Behandlung!"
                    },
                    assistantExplanation: {
                        whatHappened: "Die Zellen reagieren nicht mehr auf Insulin - meist durch Übergewicht.",
                        whyDangerous: "Hoher Blutzucker schädigt Nieren und Nerven. Ohne Behandlung tödlich.",
                        whatToDo: [
                            "Low-Carb-Futter WICHTIG!",
                            "Insulin immer 12h Abstand",
                            "Home-Monitoring lernen",
                            "Abnehmen hilft enorm!"
                        ],
                        prevention: "Idealgewicht halten! Keine Kohlenhydrat-reiche Nahrung."
                    }
                },
                katzenschnupfen: {
                    name: "Katzenschnupfenkomplex",
                    urgency: "AKUT",
                    icon: "🤧",
                    prevalence: "Sehr häufig in Tierheimen",
                    vitalChanges: {
                        heartRate: { modifier: 1.2, variance: 0.1 },
                        bloodPressure: { modifier: 1.0, variance: 0.05 },
                        temperature: { modifier: 1.15, variance: 0.1 },
                        respirationRate: { modifier: 1.3, variance: 0.1 },
                        oxygenLevel: { modifier: 0.92, variance: 0.03 },
                        bloodGlucose: { modifier: 1.0, variance: 0.05 }
                    },
                    vetAnalysis: {
                        diagnosis: "FHV-1 und Calicivirus. Sekundäre bakterielle Infektion. Ulzerative Keratitis.",
                        labValues: "Leukozytose, PCR positiv für FHV-1 und FCV",
                        treatment: "Antibiotika, antivirale Augentropfen, Inhalation, Zwangsernährung",
                        medication: "Doxycyclin 10mg/kg SID, L-Lysin 500mg BID, Famciclovir 90mg/kg BID",
                        prognosis: "Meist Heilung in 2-3 Wochen. Chronische Träger möglich"
                    },
                    assistantExplanation: {
                        whatHappened: "Viren greifen Nase, Augen und Rachen an - wie eine schwere Grippe.",
                        whyDangerous: "Katze kann nicht riechen = frisst nicht. Augen können verkleben.",
                        whatToDo: [
                            "Augen/Nase mehrmals täglich reinigen",
                            "Warmes Futter anbieten",
                            "Inhalieren über Dampf",
                            "Isolation von anderen Katzen"
                        ],
                        prevention: "IMPFUNG! Grundimmunisierung und jährliche Auffrischung."
                    }
                }
            },
            
            pferd: {
                kolik: {
                    name: "Kolik",
                    urgency: "NOTFALL",
                    icon: "🚨",
                    prevalence: "4-10% aller Pferde/Jahr",
                    vitalChanges: {
                        heartRate: { modifier: 2.5, variance: 0.3 },
                        bloodPressure: { modifier: 0.8, variance: 0.1 },
                        temperature: { modifier: 1.1, variance: 0.05 },
                        respirationRate: { modifier: 2.0, variance: 0.2 },
                        oxygenLevel: { modifier: 0.95, variance: 0.03 },
                        bloodGlucose: { modifier: 1.3, variance: 0.1 }
                    },
                    vetAnalysis: {
                        diagnosis: "Spastische Kolik/Gaskolik. Darmgeräusche hyperaktiv. Rektale: Gasblähung.",
                        labValues: "Laktat: 4.8 mmol/L, PCV: 48%, TP: 8.2 g/dl, Elektrolyte verschoben",
                        treatment: "Buscopan, Metamizol, Paraffin per Nasenschlundsonde, ggf. OP",
                        medication: "Buscopan 0.3mg/kg IV, Metamizol 25mg/kg IV, Xylazin 0.5mg/kg",
                        prognosis: "Spastische Kolik: 95% konservativ. Verlagerung: 70% OP-Erfolg"
                    },
                    assistantExplanation: {
                        whatHappened: "Der Darm hat Krämpfe oder hat sich verdreht - Pferde können nicht erbrechen.",
                        whyDangerous: "Der Darm kann absterben! Pferde können in Stunden sterben.",
                        whatToDo: [
                            "Pferd FÜHREN - langsam Schritt",
                            "KEIN Futter oder Wasser!",
                            "Puls alle 10 Min kontrollieren",
                            "Tierarzt: Wann letzter Kotabsatz?"
                        ],
                        prevention: "Regelmäßige Fütterung. Langsame Futterumstellung. Genug Bewegung."
                    }
                },
                hufrehe: {
                    name: "Hufrehe (Laminitis)",
                    urgency: "NOTFALL",
                    icon: "🦶",
                    prevalence: "15% aller Pferde erkranken im Leben",
                    vitalChanges: {
                        heartRate: { modifier: 1.8, variance: 0.2 },
                        bloodPressure: { modifier: 1.2, variance: 0.1 },
                        temperature: { modifier: 1.05, variance: 0.03 },
                        respirationRate: { modifier: 1.3, variance: 0.1 },
                        oxygenLevel: { modifier: 0.98, variance: 0.02 },
                        bloodGlucose: { modifier: 1.4, variance: 0.2 }
                    },
                    vetAnalysis: {
                        diagnosis: "Akute Hufrehe Grad III. Rotation Hufbein 8°. Pulsation A. digitalis.",
                        labValues: "Insulin: 80 μIU/ml (IR), ACTH normal, CK erhöht",
                        treatment: "Kryotherapie, Analgesie, Hufverbände, Box mit tiefer Einstreu",
                        medication: "Phenylbutazon 4mg/kg BID, Acepromazin 0.04mg/kg, Heparin",
                        prognosis: "Grad I-II: gut. Grad III-IV mit Rotation: vorsichtig"
                    },
                    assistantExplanation: {
                        whatHappened: "Die Verbindung zwischen Hufbein und Hufkapsel löst sich - extrem schmerzhaft!",
                        whyDangerous: "Das Hufbein kann durch die Sohle brechen. Pferd kann nie mehr laufen.",
                        whatToDo: [
                            "SOFORT Hufe kühlen (Eis/kaltes Wasser)",
                            "Weiche, tiefe Einstreu",
                            "KEIN Kraftfutter!",
                            "Pferd NICHT bewegen"
                        ],
                        prevention: "Kein frisches Gras im Frühling! Übergewicht vermeiden. Cushing behandeln."
                    }
                },
                cushing: {
                    name: "Equines Cushing Syndrom (PPID)",
                    urgency: "CHRONISCH",
                    icon: "💊",
                    prevalence: "20-30% aller Pferde >15 Jahre",
                    vitalChanges: {
                        heartRate: { modifier: 1.1, variance: 0.05 },
                        bloodPressure: { modifier: 1.1, variance: 0.05 },
                        temperature: { modifier: 1.0, variance: 0.02 },
                        respirationRate: { modifier: 1.1, variance: 0.05 },
                        oxygenLevel: { modifier: 0.98, variance: 0.02 },
                        bloodGlucose: { modifier: 1.5, variance: 0.2 }
                    },
                    vetAnalysis: {
                        diagnosis: "PPID. ACTH: 95 pg/ml (Ref: <35). Hirsutismus. Insulinresistenz.",
                        labValues: "ACTH: 95 pg/ml, Insulin: 60 μIU/ml, Cortisol erhöht",
                        treatment: "Pergolid lebenslang, Management Insulinresistenz, Hufreheprophylaxe",
                        medication: "Pergolid 2μg/kg SID (Prascend), ggf. Metformin",
                        prognosis: "Mit Behandlung: gute Lebensqualität für Jahre möglich"
                    },
                    assistantExplanation: {
                        whatHappened: "Die Hirnanhangsdrüse produziert zu viele Hormone - wie ein defekter Thermostat.",
                        whyDangerous: "Führt zu Hufrehe! Immunsystem schwach. Fell wächst unkontrolliert.",
                        whatToDo: [
                            "Tabletten TÄGLICH - lebenslang!",
                            "Fell scheren im Sommer",
                            "Zucker/Stärke reduzieren",
                            "Regelmäßige Hufkontrolle"
                        ],
                        prevention: "Nicht verhinderbar. Früherkennung durch jährlichen ACTH-Test ab 15 Jahren."
                    }
                },
                cob: {
                    name: "COB/RAO (Dämpfigkeit)",
                    urgency: "CHRONISCH",
                    icon: "🫁",
                    prevalence: "10-15% aller Pferde",
                    vitalChanges: {
                        heartRate: { modifier: 1.3, variance: 0.1 },
                        bloodPressure: { modifier: 1.1, variance: 0.05 },
                        temperature: { modifier: 1.0, variance: 0.02 },
                        respirationRate: { modifier: 2.0, variance: 0.3 },
                        oxygenLevel: { modifier: 0.85, variance: 0.05 },
                        bloodGlucose: { modifier: 1.0, variance: 0.05 }
                    },
                    vetAnalysis: {
                        diagnosis: "RAO/IAD. Bronchospasmus. Bauchatmung. Dampfrinne.",
                        labValues: "BAL: Neutrophilie >25%, Blutgase: PaO₂ erniedrigt",
                        treatment: "Haltungsoptimierung! Bronchodilatatoren, Kortikosteroide inhalativ",
                        medication: "Clenbuterol 0.8μg/kg BID, Dexamethason 0.04mg/kg, Inhalation",
                        prognosis: "Mit Management kontrollierbar, aber nicht heilbar"
                    },
                    assistantExplanation: {
                        whatHappened: "Die Lunge reagiert allergisch auf Staub - wie Asthma beim Menschen.",
                        whyDangerous: "Pferd bekommt keine Luft mehr. Kann nicht mehr geritten werden.",
                        whatToDo: [
                            "KEIN Heu! Nur nasses Heu oder Heulage",
                            "Staubarme Einstreu (keine Stroh!)",
                            "Viel frische Luft - Offenstall ideal",
                            "Inhalieren hilft"
                        ],
                        prevention: "Staubarme Haltung von Anfang an. Heu wässern. Gute Belüftung."
                    }
                },
                sommerekzem: {
                    name: "Sommerekzem",
                    urgency: "SAISONAL",
                    icon: "☀️",
                    prevalence: "Isländer: bis 50%, andere Rassen: 5-10%",
                    vitalChanges: {
                        heartRate: { modifier: 1.1, variance: 0.05 },
                        bloodPressure: { modifier: 1.0, variance: 0.02 },
                        temperature: { modifier: 1.0, variance: 0.02 },
                        respirationRate: { modifier: 1.0, variance: 0.02 },
                        oxygenLevel: { modifier: 1.0, variance: 0.01 },
                        bloodGlucose: { modifier: 1.0, variance: 0.05 }
                    },
                    vetAnalysis: {
                        diagnosis: "Culicoides-Hypersensitivität Typ I. Sekundäre Hautinfektionen.",
                        labValues: "IgE gegen Culicoides erhöht, Eosinophilie",
                        treatment: "Ekzemerdecke, Repellents, Kortison, Antihistaminika",
                        medication: "Cetirizin 0.4mg/kg BID, Prednisolon 0.5mg/kg bei schweren Fällen",
                        prognosis: "Jährlich wiederkehrend, mit Management erträglich"
                    },
                    assistantExplanation: {
                        whatHappened: "Allergie gegen Mückenstiche - das Immunsystem überreagiert extrem.",
                        whyDangerous: "Pferd scheuert sich blutig. Infektionen. Kann nicht geritten werden.",
                        whatToDo: [
                            "Ekzemerdecke 24/7 in der Saison",
                            "Morgens/abends im Stall (Mückenzeit)",
                            "Fliegenspray täglich",
                            "Offene Stellen desinfizieren"
                        ],
                        prevention: "Import-Pferde aus Island besonders gefährdet. Decke ab April!"
                    }
                },
                druse: {
                    name: "Druse (Streptococcus equi)",
                    urgency: "AKUT",
                    icon: "🦠",
                    prevalence: "Hochansteckend in Beständen",
                    vitalChanges: {
                        heartRate: { modifier: 1.3, variance: 0.1 },
                        bloodPressure: { modifier: 1.0, variance: 0.05 },
                        temperature: { modifier: 1.2, variance: 0.1 },
                        respirationRate: { modifier: 1.2, variance: 0.1 },
                        oxygenLevel: { modifier: 0.95, variance: 0.03 },
                        bloodGlucose: { modifier: 1.1, variance: 0.05 }
                    },
                    vetAnalysis: {
                        diagnosis: "Streptococcus equi ssp. equi. Lymphadenitis. Abszedierung.",
                        labValues: "Leukozytose, SAA stark erhöht, PCR positiv",
                        treatment: "Quarantäne! Abszessreifung abwarten, dann Spaltung. Meist kein AB",
                        medication: "Penicillin nur bei Komplikationen, NSAIDs für Fieber",
                        prognosis: "Meist Heilung in 3-6 Wochen. 10% werden Dauerausscheider"
                    },
                    assistantExplanation: {
                        whatHappened: "Hochansteckende Bakterien - wie Mandelentzündung die außer Kontrolle gerät.",
                        whyDangerous: "Lymphknoten schwellen extrem an. Pferd kann ersticken!",
                        whatToDo: [
                            "QUARANTÄNE! Kein Kontakt zu anderen Pferden",
                            "Eigene Gerätschaften",
                            "Abszesse reifen lassen",
                            "Desinfektion ALLES"
                        ],
                        prevention: "Neue Pferde 3 Wochen isolieren. Impfung möglich aber umstritten."
                    }
                }
            },
            
            kaninchen: {
                gi_stasis: {
                    name: "Gastrointestinale Stasis",
                    urgency: "NOTFALL",
                    icon: "🚨",
                    prevalence: "Häufigste Erkrankung bei Kaninchen",
                    vitalChanges: {
                        heartRate: { modifier: 0.8, variance: 0.1 },
                        bloodPressure: { modifier: 0.85, variance: 0.05 },
                        temperature: { modifier: 0.95, variance: 0.02 },
                        respirationRate: { modifier: 0.7, variance: 0.1 },
                        oxygenLevel: { modifier: 0.97, variance: 0.02 },
                        bloodGlucose: { modifier: 0.6, variance: 0.1 }
                    },
                    vetAnalysis: {
                        diagnosis: "Ileus. Magenüberladung palpabel. Caecum atone. Gasansammlung.",
                        labValues: "Glukose: 45 mg/dl (Hypoglykämie!), Leberwerte steigend",
                        treatment: "Aggressive Flüssigkeitstherapie, Zwangsfütterung, Prokinetika",
                        medication: "Metoclopramid 0.5mg/kg TID, Simethicon 20mg/kg, Meloxicam 0.2mg/kg",
                        prognosis: "Bei früher Behandlung gut. Nach 48h Anorexie kritisch"
                    },
                    assistantExplanation: {
                        whatHappened: "Der Darm hat aufgehört zu arbeiten - wie ein Motor der nicht anspringt.",
                        whyDangerous: "Kaninchen MÜSSEN immer fressen! Nach 12h beginnt Leberversagen.",
                        whatToDo: [
                            "SOFORT Päppelbrei alle 2h",
                            "Bauchmassage sanft im Uhrzeigersinn",
                            "Wärmflasche an Bauch",
                            "Bewegung animieren"
                        ],
                        prevention: "IMMER Heu verfügbar! Keine plötzliche Futterumstellung. Stress vermeiden."
                    }
                },
                e_cuniculi: {
                    name: "Encephalitozoon cuniculi",
                    urgency: "CHRONISCH",
                    icon: "🦠",
                    prevalence: "50-70% Durchseuchung, meist symptomlos",
                    vitalChanges: {
                        heartRate: { modifier: 1.1, variance: 0.05 },
                        bloodPressure: { modifier: 1.0, variance: 0.02 },
                        temperature: { modifier: 1.0, variance: 0.02 },
                        respirationRate: { modifier: 1.0, variance: 0.05 },
                        oxygenLevel: { modifier: 0.98, variance: 0.02 },
                        bloodGlucose: { modifier: 1.0, variance: 0.05 }
                    },
                    vetAnalysis: {
                        diagnosis: "E. cuniculi Titer 1:512. Kopfschiefhaltung 45°. Nystagmus.",
                        labValues: "IgG-Titer positiv, Kreatinin leicht erhöht, Proteinurie",
                        treatment: "Fenbendazol 28 Tage, supportive Therapie, Physiotherapie",
                        medication: "Fenbendazol 20mg/kg SID für 28 Tage, B-Vitamine, ggf. Meclizin",
                        prognosis: "Mit Behandlung oft Besserung. Kopfschiefhaltung kann bleiben"
                    },
                    assistantExplanation: {
                        whatHappened: "Ein Parasit greift Gehirn, Nieren und Augen an - meist lange unbemerkt.",
                        whyDangerous: "Plötzliche Lähmungen oder Kopfschiefhaltung. Kaninchen kann nicht fressen.",
                        whatToDo: [
                            "Medikamente 28 Tage durchgeben!",
                            "Käfig polstern gegen Verletzung",
                            "Von Hand füttern wenn nötig",
                            "Physiotherapie hilft!"
                        ],
                        prevention: "Stress vermeiden - aktiviert den Parasiten. Neue Kaninchen testen."
                    }
                },
                zahnprobleme: {
                    name: "Zahnfehlstellung/Zahnspitzen",
                    urgency: "DRINGEND",
                    icon: "🦷",
                    prevalence: "Sehr häufig, besonders bei Zwergkaninchen",
                    vitalChanges: {
                        heartRate: { modifier: 1.1, variance: 0.05 },
                        bloodPressure: { modifier: 1.0, variance: 0.02 },
                        temperature: { modifier: 1.0, variance: 0.02 },
                        respirationRate: { modifier: 1.0, variance: 0.05 },
                        oxygenLevel: { modifier: 1.0, variance: 0.01 },
                        bloodGlucose: { modifier: 0.8, variance: 0.1 }
                    },
                    vetAnalysis: {
                        diagnosis: "Malokklusio. Zahnspitzen lingual/bukkal. Brückenbildung.",
                        labValues: "Normale Blutwerte, ggf. leichte Dehydratation",
                        treatment: "Zahnkorrektur in Narkose, regelmäßige Kontrollen alle 6-8 Wochen",
                        medication: "Meloxicam 0.2mg/kg, Tramadol 10mg/kg bei starken Schmerzen",
                        prognosis: "Lebenslange regelmäßige Zahnkorrekturen nötig"
                    },
                    assistantExplanation: {
                        whatHappened: "Die Zähne wachsen schief und werden zu lang - wie Dolche im Mund.",
                        whyDangerous: "Kaninchen kann nicht mehr kauen. Verhungert vor vollem Napf!",
                        whatToDo: [
                            "Regelmäßig Zähne kontrollieren lassen",
                            "Weiches Futter anbieten",
                            "Gewicht täglich kontrollieren",
                            "Päppelbrei bei Bedarf"
                        ],
                        prevention: "Viel Heu! Äste zum Nagen. Keine Pellets als Hauptfutter."
                    }
                },
                myxomatose: {
                    name: "Myxomatose",
                    urgency: "NOTFALL",
                    icon: "💉",
                    prevalence: "Seuchenzüge regional unterschiedlich",
                    vitalChanges: {
                        heartRate: { modifier: 1.3, variance: 0.1 },
                        bloodPressure: { modifier: 0.9, variance: 0.05 },
                        temperature: { modifier: 1.2, variance: 0.1 },
                        respirationRate: { modifier: 1.3, variance: 0.1 },
                        oxygenLevel: { modifier: 0.9, variance: 0.05 },
                        bloodGlucose: { modifier: 0.9, variance: 0.1 }
                    },
                    vetAnalysis: {
                        diagnosis: "Myxomatosevirus. Myxome. Konjunktivitis. Genitalödeme.",
                        labValues: "Leukopenie, Thrombozytopenie",
                        treatment: "Nur supportiv. Antibiotika gegen Sekundärinfektionen. Meist Euthanasie.",
                        medication: "Enrofloxacin 10mg/kg BID, intensive Pflege, Zwangsernährung",
                        prognosis: "Ungeimpft: 20-100% Mortalität je nach Virusstamm"
                    },
                    assistantExplanation: {
                        whatHappened: "Ein tödliches Virus von Mücken übertragen - Augen schwellen zu.",
                        whyDangerous: "Kaninchen erblindet und erstickt. Meist tödlich ohne Impfung!",
                        whatToDo: [
                            "SOFORT zum Tierarzt!",
                            "Isolation von anderen Kaninchen",
                            "Mückenschutz maximal",
                            "Intensive Pflege nötig"
                        ],
                        prevention: "IMPFUNG! Halbjährlich oder jährlich. Mückenschutz im Sommer."
                    }
                },
                rhd: {
                    name: "RHD/RHD2 (Chinaseuche)",
                    urgency: "NOTFALL",
                    icon: "☠️",
                    prevalence: "Hochansteckend, 70-100% Mortalität",
                    vitalChanges: {
                        heartRate: { modifier: 1.5, variance: 0.2 },
                        bloodPressure: { modifier: 0.7, variance: 0.1 },
                        temperature: { modifier: 1.3, variance: 0.1 },
                        respirationRate: { modifier: 1.5, variance: 0.2 },
                        oxygenLevel: { modifier: 0.85, variance: 0.05 },
                        bloodGlucose: { modifier: 0.8, variance: 0.1 }
                    },
                    vetAnalysis: {
                        diagnosis: "Calicivirus. Hepatitis. DIC. Lungenödem.",
                        labValues: "Transaminasen massiv erhöht, Gerinnungsstörung, Thrombozytopenie",
                        treatment: "Keine kausale Therapie. Intensivmedizin meist erfolglos.",
                        medication: "Supportive Intensivtherapie, meist keine Zeit für Behandlung",
                        prognosis: "RHD1: Tod in 12-36h. RHD2: Tod in 3-9 Tagen. Überlebensrate <10%"
                    },
                    assistantExplanation: {
                        whatHappened: "Killervirus greift Leber und Blutgerinnung an - meist ohne Vorwarnung.",
                        whyDangerous: "Kaninchen stirbt innerhalb von Stunden bis Tagen! Hochansteckend!",
                        whatToDo: [
                            "NOTFALL - meist zu spät",
                            "Andere Kaninchen SOFORT impfen",
                            "Komplette Desinfektion",
                            "Quarantäne 6 Wochen"
                        ],
                        prevention: "IMPFUNG PFLICHT! RHD1 und RHD2 getrennt oder Kombi. Jährlich!"
                    }
                },
                blasenschlamm: {
                    name: "Blasenschlamm/Urolithiasis",
                    urgency: "AKUT",
                    icon: "💧",
                    prevalence: "Häufig bei falscher Fütterung",
                    vitalChanges: {
                        heartRate: { modifier: 1.2, variance: 0.1 },
                        bloodPressure: { modifier: 1.1, variance: 0.05 },
                        temperature: { modifier: 1.02, variance: 0.02 },
                        respirationRate: { modifier: 1.1, variance: 0.05 },
                        oxygenLevel: { modifier: 0.98, variance: 0.02 },
                        bloodGlucose: { modifier: 1.0, variance: 0.05 }
                    },
                    vetAnalysis: {
                        diagnosis: "Kalziumkarbonat-Schlamm. Blasenwandverdickung. pH alkalisch.",
                        labValues: "Kalzium im Urin massiv erhöht, Urin-pH >8.5",
                        treatment: "Blasenspülung, Flüssigkeitstherapie, Ernährungsumstellung",
                        medication: "Meloxicam 0.2mg/kg, ggf. Antibiotika bei Zystitis",
                        prognosis: "Mit Ernährungsumstellung gut kontrollierbar"
                    },
                    assistantExplanation: {
                        whatHappened: "Zu viel Kalzium im Urin - wie Schlamm in der Blase.",
                        whyDangerous: "Blasensteine können entstehen. Schmerzen beim Pinkeln.",
                        whatToDo: [
                            "Kalziumarmes Futter!",
                            "Viel Wasser anbieten",
                            "Keine Luzerne mehr",
                            "Frischfutter erhöhen"
                        ],
                        prevention: "Kein kalziumreiches Trockenfutter. Löwenzahn nur in Maßen."
                    }
                }
            }
        };

        // ============================================
        // GAMIFICATION SYSTEM
        // ============================================
        
        class VetCareerSystem {
            constructor() {
                this.experience = parseInt(localStorage.getItem('vetXP') || '0');
                this.level = this.calculateLevel();
                this.achievements = JSON.parse(localStorage.getItem('vetAchievements') || '[]');
                this.treatedAnimals = JSON.parse(localStorage.getItem('vetTreatedAnimals') || '[]');
                this.stats = JSON.parse(localStorage.getItem('vetStats') || '{"totalCases":0,"perfectDiagnoses":0,"emergenciesSaved":0}');
            }

            levelProgression = [
                { level: 'Praktikant', xpRequired: 0, icon: '🎓' },
                { level: 'Assistenz-TFA', xpRequired: 100, icon: '👨‍⚕️' },
                { level: 'TFA', xpRequired: 500, icon: '💉' },
                { level: 'Leitende TFA', xpRequired: 1000, icon: '⭐' },
                { level: 'Junior-Veterinär', xpRequired: 2000, icon: '🏥' },
                { level: 'Veterinär', xpRequired: 5000, icon: '👨‍⚕️' },
                { level: 'Spezialist', xpRequired: 10000, icon: '🏆' }
            ];

            calculateLevel() {
                for (let i = this.levelProgression.length - 1; i >= 0; i--) {
                    if (this.experience >= this.levelProgression[i].xpRequired) {
                        return this.levelProgression[i];
                    }
                }
                return this.levelProgression[0];
            }

            addExperience(xp) {
                this.experience += xp;
                localStorage.setItem('vetXP', this.experience);
                const newLevel = this.calculateLevel();
                if (newLevel.level !== this.level.level) {
                    this.showLevelUp(newLevel);
                }
                this.level = newLevel;
                return xp;
            }

            showLevelUp(newLevel) {
                const notification = document.createElement('div');
                notification.className = 'fixed top-4 right-4 bg-green-600 text-white p-4 rounded-lg shadow-lg slide-in z-50';
                notification.innerHTML = `
                    <div class="flex items-center gap-3">
                        <span class="text-3xl">${newLevel.icon}</span>
                        <div>
                            <p class="font-bold">LEVEL UP!</p>
                            <p>Du bist jetzt: ${newLevel.level}</p>
                        </div>
                    </div>
                `;
                document.body.appendChild(notification);
                setTimeout(() => notification.remove(), 3000);
            }

            unlockAchievement(id, name, icon) {
                if (!this.achievements.includes(id)) {
                    this.achievements.push(id);
                    localStorage.setItem('vetAchievements', JSON.stringify(this.achievements));
                    this.showAchievement(name, icon);
                    this.addExperience(25);
                }
            }

            showAchievement(name, icon) {
                const notification = document.createElement('div');
                notification.className = 'fixed top-4 left-4 bg-yellow-600 text-white p-4 rounded-lg shadow-lg slide-in z-50';
                notification.innerHTML = `
                    <div class="flex items-center gap-3">
                        <span class="text-3xl">${icon}</span>
                        <div>
                            <p class="font-bold">ACHIEVEMENT!</p>
                            <p>${name}</p>
                        </div>
                    </div>
                `;
                document.body.appendChild(notification);
                setTimeout(() => notification.remove(), 3000);
            }

            updateStats(type) {
                this.stats[type] = (this.stats[type] || 0) + 1;
                localStorage.setItem('vetStats', JSON.stringify(this.stats));

                // Check for achievements
                if (this.stats.totalCases === 1) {
                    this.unlockAchievement('first_case', 'Erster Patient', '🏥');
                }
                if (this.stats.perfectDiagnoses === 5) {
                    this.unlockAchievement('perfect_5', 'Perfektionist', '⭐');
                }
                if (this.stats.emergenciesSaved === 3) {
                    this.unlockAchievement('emergency_hero', 'Notfall-Held', '🚨');
                }
            }
        }

        // ============================================
        // HAUPTANWENDUNG
        // ============================================
        
        const app = {
            stage: 'menu',
            mode: 'assistant', // 'assistant' oder 'vet'
            selectedAnimalType: 'hund',
            selectedDisease: '',
            uploadedImage: null,
            scanProgress: 0,
            vitals: {},
            careerSystem: new VetCareerSystem(),
            currentCase: null,
            timer: null,
            timeElapsed: 0
        };

        // Hilfsfunktionen
        function generateVitals(animal, disease) {
            const normalRanges = vitalNormalRanges[animal];
            const diseaseData = diseasesByAnimal[animal]?.[disease];
            const vitals = {};

            Object.keys(normalRanges).forEach(vital => {
                const normal = normalRanges[vital];
                const modifier = diseaseData?.vitalChanges[vital] || { modifier: 1, variance: 0 };
                
                const baseValue = (normal.min + normal.max) / 2;
                const variance = (Math.random() - 0.5) * modifier.variance;
                const finalValue = baseValue * modifier.modifier * (1 + variance);
                
                // Clamp to reasonable ranges
                const clampedValue = Math.max(
                    normal.min * 0.5,
                    Math.min(normal.max * 2, finalValue)
                );
                
                vitals[vital] = {
                    value: vital === 'temperature' ? 
                        clampedValue.toFixed(1) : 
                        Math.round(clampedValue),
                    unit: normal.unit,
                    normal: normal,
                    status: evaluateVitalStatus(clampedValue, normal)
                };
            });

            return vitals;
        }

        function evaluateVitalStatus(value, normal) {
            const range = normal.max - normal.min;
            const warningThreshold = range * 0.15;
            
            if (value >= normal.min && value <= normal.max) {
                return { level: 'normal', color: 'text-green-400', bgColor: 'bg-green-900/30', icon: '✓' };
            } else if (value < normal.min - warningThreshold || value > normal.max + warningThreshold) {
                return { level: 'kritisch', color: 'text-red-400', bgColor: 'bg-red-900/30', icon: '⚠️' };
            } else {
                return { level: 'warnung', color: 'text-orange-400', bgColor: 'bg-orange-900/30', icon: '!' };
            }
        }

        function startTimer() {
            app.timeElapsed = 0;
            app.timer = setInterval(() => {
                app.timeElapsed++;
                updateTimerDisplay();
            }, 1000);
        }

        function stopTimer() {
            if (app.timer) {
                clearInterval(app.timer);
                app.timer = null;
            }
        }

        function updateTimerDisplay() {
            const timerEl = document.getElementById('timer');
            if (timerEl) {
                const minutes = Math.floor(app.timeElapsed / 60);
                const seconds = app.timeElapsed % 60;
                timerEl.textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;
            }
        }

        function calculateXP(correct, timeBonus, emergency) {
            let xp = 0;
            if (correct) xp += 50;
            if (timeBonus) xp += 20;
            if (emergency) xp += 30;
            return xp;
        }

        // Render-Funktionen
        function render() {
            const root = document.getElementById('root');
            
            if (app.stage === 'menu') {
                renderMenu(root);
            } else if (app.stage === 'input') {
                renderInput(root);
            } else if (app.stage === 'scanning') {
                renderScanning(root);
            } else if (app.stage === 'results') {
                renderResults(root);
            }
        }

        function renderMenu(root) {
            root.innerHTML = `
                <div class="min-h-screen bg-gray-950 relative flex items-center justify-center">
                    <div class="max-w-4xl w-full p-8">
                        <div class="bg-gray-900/60 backdrop-blur-md rounded-lg p-8 border border-cyan-800 shadow-2xl">
                            <div class="text-center mb-8">
                                <h1 class="text-4xl font-bold text-cyan-400 mb-2">VetScan Pro 3000</h1>
                                <p class="text-xl text-cyan-600">Professional Edition</p>
                                <p class="text-sm text-green-400 mt-2">✅ Medizinisch korrekt & tierartspezifisch</p>
                                <div class="mt-4 flex justify-center gap-4">
                                    <span class="text-sm">Level: ${app.careerSystem.level.level} ${app.careerSystem.level.icon}</span>
                                    <span class="text-sm">XP: ${app.careerSystem.experience}</span>
                                    <span class="text-sm">Fälle: ${app.careerSystem.stats.totalCases}</span>
                                </div>
                            </div>
                            
                            <div class="space-y-6">
                                <div>
                                    <h2 class="text-lg font-bold mb-4 text-cyan-400">Wähle deinen Modus:</h2>
                                    <div class="grid grid-cols-2 gap-4">
                                        <button onclick="selectMode('assistant')" class="p-6 bg-gray-800 hover:bg-gray-700 rounded-lg border-2 ${app.mode === 'assistant' ? 'border-cyan-400' : 'border-gray-700'} transition-all">
                                            <span class="text-3xl block mb-2">👨‍⚕️</span>
                                            <p class="font-bold">Assistenz-Modus</p>
                                            <p class="text-sm text-gray-400 mt-2">Einfache Erklärungen und klare Anweisungen</p>
                                        </button>
                                        <button onclick="selectMode('vet')" class="p-6 bg-gray-800 hover:bg-gray-700 rounded-lg border-2 ${app.mode === 'vet' ? 'border-cyan-400' : 'border-gray-700'} transition-all">
                                            <span class="text-3xl block mb-2">🔬</span>
                                            <p class="font-bold">Veterinär-Modus</p>
                                            <p class="text-sm text-gray-400 mt-2">Wissenschaftliche Analyse mit Laborwerten</p>
                                        </button>
                                    </div>
                                </div>
                                
                                <button onclick="startGame()" class="w-full py-4 bg-cyan-600 hover:bg-cyan-500 text-gray-900 font-bold rounded-lg transition-all transform hover:scale-105 shadow-lg">
                                    SPIEL STARTEN
                                </button>
                                
                                <div class="grid grid-cols-3 gap-4 mt-6">
                                    <div class="bg-gray-800 p-3 rounded text-center">
                                        <span class="text-2xl">🏆</span>
                                        <p class="text-xs mt-1">Achievements</p>
                                        <p class="font-bold">${app.careerSystem.achievements.length}</p>
                                    </div>
                                    <div class="bg-gray-800 p-3 rounded text-center">
                                        <span class="text-2xl">⭐</span>
                                        <p class="text-xs mt-1">Perfekt</p>
                                        <p class="font-bold">${app.careerSystem.stats.perfectDiagnoses || 0}</p>
                                    </div>
                                    <div class="bg-gray-800 p-3 rounded text-center">
                                        <span class="text-2xl">🚨</span>
                                        <p class="text-xs mt-1">Notfälle</p>
                                        <p class="font-bold">${app.careerSystem.stats.emergenciesSaved || 0}</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderInput(root) {
            // Dynamische Krankheitsliste basierend auf Tierart
            const animalDiseases = diseasesByAnimal[app.selectedAnimalType] || {};
            
            root.innerHTML = `
                <div class="min-h-screen bg-gray-950 relative">
                    <!-- Header -->
                    <div class="border-b border-cyan-800 bg-gray-900/80 backdrop-blur-sm">
                        <div class="p-4 flex items-center justify-between">
                            <div class="flex items-center gap-4">
                                <h1 class="text-2xl font-bold text-cyan-400">⚡ VetScan Pro 3000</h1>
                                <div class="text-xs text-cyan-600">Professional | ${app.mode === 'vet' ? 'Veterinär' : 'Assistenz'}-Modus</div>
                            </div>
                            <div class="flex items-center gap-4">
                                <span class="text-sm">${app.careerSystem.level.icon} ${app.careerSystem.level.level}</span>
                                <span class="text-sm">XP: ${app.careerSystem.experience}</span>
                                <button onclick="backToMenu()" class="text-sm hover:text-cyan-400">Menü</button>
                            </div>
                        </div>
                    </div>

                    <!-- Main Content -->
                    <div class="p-8">
                        <div class="max-w-4xl mx-auto">
                            <div class="bg-gray-900/60 backdrop-blur-md rounded-lg p-8 border border-cyan-800 shadow-2xl">
                                <h2 class="text-xl font-bold mb-6">🏥 PATIENT AUFNEHMEN</h2>
                                
                                <div class="space-y-6">
                                    <div class="grid grid-cols-2 gap-4">
                                        <div>
                                            <label class="block text-sm mb-2 text-cyan-400">TIERART:</label>
                                            <select id="animalType" onchange="updateAnimalType(this.value)" class="w-full p-3 bg-gray-800 border border-cyan-700 rounded text-cyan-300">
                                                <option value="hund" ${app.selectedAnimalType === 'hund' ? 'selected' : ''}>🐕 Hund</option>
                                                <option value="katze" ${app.selectedAnimalType === 'katze' ? 'selected' : ''}>🐈 Katze</option>
                                                <option value="pferd" ${app.selectedAnimalType === 'pferd' ? 'selected' : ''}>🐴 Pferd</option>
                                                <option value="kaninchen" ${app.selectedAnimalType === 'kaninchen' ? 'selected' : ''}>🐰 Kaninchen</option>
                                            </select>
                                        </div>
                                        <div>
                                            <label class="block text-sm mb-2 text-cyan-400">VERDACHTSDIAGNOSE:</label>
                                            <select id="disease" onchange="updateDisease(this.value)" class="w-full p-3 bg-gray-800 border border-cyan-700 rounded text-cyan-300">
                                                <option value="">-- Bitte wählen --</option>
                                                ${Object.entries(animalDiseases).map(([key, disease]) => 
                                                    `<option value="${key}">${disease.icon} ${disease.name} ${disease.urgency === 'NOTFALL' ? '🚨' : ''}</option>`
                                                ).join('')}
                                            </select>
                                        </div>
                                    </div>

                                    <div id="diseaseInfo" class="hidden p-4 bg-gray-800 rounded border border-cyan-700">
                                        <p class="text-sm text-cyan-600" id="diseasePrevalence"></p>
                                    </div>

                                    <div>
                                        <label class="block text-sm mb-2 text-cyan-400">PATIENT SCAN-BILD:</label>
                                        <div class="border-2 border-dashed border-cyan-700 rounded-lg p-8 text-center hover:border-cyan-400 transition-colors bg-gray-800/50">
                                            <input type="file" id="imageUpload" accept="image/*" class="hidden" onchange="handleImageUpload(event)">
                                            <label for="imageUpload" class="cursor-pointer">
                                                <div id="imagePreview">
                                                    <div class="text-6xl mb-2">📷</div>
                                                    <p>KLICKEN FÜR BILD-UPLOAD</p>
                                                </div>
                                            </label>
                                        </div>
                                    </div>

                                    <div id="urgencyWarning" class="hidden p-4 bg-red-900/30 border border-red-600 rounded-lg">
                                        <p class="font-bold text-red-400">⚠️ NOTFALL ERKANNT!</p>
                                        <p class="text-sm">Dieser Fall erfordert sofortiges Handeln. Die Zeit läuft!</p>
                                    </div>

                                    <button id="scanBtn" onclick="startScan()" disabled class="w-full py-4 rounded font-bold bg-gray-700 text-gray-500 cursor-not-allowed">
                                        SCAN INITIALISIEREN
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderScanning(root) {
            const disease = diseasesByAnimal[app.selectedAnimalType]?.[app.selectedDisease];
            
            root.innerHTML = `
                <div class="min-h-screen bg-gray-950 relative">
                    <!-- Header -->
                    <div class="border-b border-cyan-800 bg-gray-900/80 backdrop-blur-sm">
                        <div class="p-4 flex items-center justify-between">
                            <div class="flex items-center gap-4">
                                <h1 class="text-2xl font-bold text-cyan-400">⚡ VetScan Pro 3000</h1>
                            </div>
                            ${disease?.urgency === 'NOTFALL' ? `
                                <div class="text-red-400 font-bold animate-pulse">
                                    ⏱️ NOTFALL-TIMER: <span id="timer">0:00</span>
                                </div>
                            ` : ''}
                        </div>
                    </div>

                    <div class="p-8">
                        <div class="max-w-4xl mx-auto">
                            <div class="bg-gray-900/60 backdrop-blur-md rounded-lg p-8 border border-cyan-800">
                                <h2 class="text-xl font-bold mb-6">
                                    <span class="animate-spin inline-block">⚙</span> MEDIZINISCHER SCAN LÄUFT...
                                </h2>
                                
                                ${app.uploadedImage ? `
                                    <div class="relative overflow-hidden rounded-lg mb-6">
                                        <img src="${app.uploadedImage}" class="w-full opacity-50">
                                        <div class="absolute inset-0 bg-gradient-to-b from-cyan-400/20 to-transparent" 
                                             style="transform: translateY(${100 - app.scanProgress}%); transition: transform 0.1s linear;">
                                        </div>
                                        <div class="absolute top-4 left-4 bg-gray-900/80 p-2 rounded">
                                            <p class="text-xs text-cyan-400">Analysiere: ${app.selectedAnimalType.toUpperCase()}</p>
                                            <p class="text-xs text-cyan-600">Verdacht: ${disease?.name || 'Unbekannt'}</p>
                                        </div>
                                    </div>
                                ` : ''}
                                
                                <div class="space-y-4">
                                    <div class="space-y-2">
                                        <div class="flex justify-between text-sm">
                                            <span>SCAN-FORTSCHRITT</span>
                                            <span>${app.scanProgress}%</span>
                                        </div>
                                        <div class="w-full bg-gray-800 rounded-full h-4 overflow-hidden">
                                            <div class="h-full bg-gradient-to-r from-cyan-600 to-cyan-400" 
                                                 style="width: ${app.scanProgress}%; transition: width 0.1s linear;">
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="grid grid-cols-3 gap-4 text-center">
                                        <div class="bg-gray-800 p-3 rounded border border-cyan-700">
                                            <p class="text-xs text-cyan-600">VITALWERTE</p>
                                            <p class="text-lg font-bold ${app.scanProgress > 30 ? 'text-green-400' : 'text-gray-600'}">
                                                ${app.scanProgress > 30 ? '✓' : '...'}
                                            </p>
                                        </div>
                                        <div class="bg-gray-800 p-3 rounded border border-cyan-700">
                                            <p class="text-xs text-cyan-600">LABORWERTE</p>
                                            <p class="text-lg font-bold ${app.scanProgress > 60 ? 'text-green-400' : 'text-gray-600'}">
                                                ${app.scanProgress > 60 ? '✓' : '...'}
                                            </p>
                                        </div>
                                        <div class="bg-gray-800 p-3 rounded border border-cyan-700">
                                            <p class="text-xs text-cyan-600">DIAGNOSE</p>
                                            <p class="text-lg font-bold ${app.scanProgress > 90 ? 'text-green-400' : 'text-gray-600'}">
                                                ${app.scanProgress > 90 ? '✓' : '...'}
                                            </p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;

            // Scan Animation
            if (app.scanProgress < 100) {
                setTimeout(() => {
                    app.scanProgress += 2;
                    if (app.scanProgress >= 100) {
                        app.stage = 'results';
                        app.vitals = generateVitals(app.selectedAnimalType, app.selectedDisease);
                        stopTimer();
                        
                        // Calculate XP
                        const isEmergency = disease?.urgency === 'NOTFALL';
                        const timeBonus = app.timeElapsed < 60;
                        const xp = calculateXP(true, timeBonus, isEmergency);
                        app.careerSystem.addExperience(xp);
                        app.careerSystem.updateStats('totalCases');
                        
                        if (isEmergency) {
                            app.careerSystem.updateStats('emergenciesSaved');
                        }
                    }
                    render();
                }, 50);
            }
        }

        function renderResults(root) {
            const disease = diseasesByAnimal[app.selectedAnimalType]?.[app.selectedDisease];
            const isVetMode = app.mode === 'vet';
            const analysis = isVetMode ? disease?.vetAnalysis : disease?.assistantExplanation;

            root.innerHTML = `
                <div class="min-h-screen bg-gray-950 relative">
                    <!-- Header -->
                    <div class="border-b border-cyan-800 bg-gray-900/80 backdrop-blur-sm">
                        <div class="p-4 flex items-center justify-between">
                            <div class="flex items-center gap-4">
                                <h1 class="text-2xl font-bold text-cyan-400">⚡ VetScan Pro 3000</h1>
                            </div>
                            <div class="text-green-400">
                                ✓ ANALYSE ABGESCHLOSSEN ${app.timeElapsed ? `(${Math.floor(app.timeElapsed/60)}:${(app.timeElapsed%60).toString().padStart(2,'0')})` : ''}
                            </div>
                        </div>
                    </div>

                    <div class="p-8">
                        <div class="max-w-6xl mx-auto">
                            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                                <!-- Left: Diagnosis -->
                                <div class="bg-gray-900/60 backdrop-blur-md rounded-lg p-6 border border-cyan-800">
                                    <h2 class="text-xl font-bold mb-4 flex items-center gap-2">
                                        ${disease?.icon || '🏥'} ${disease?.name || 'Diagnose'}
                                        ${disease?.urgency === 'NOTFALL' ? '<span class="ml-2 px-2 py-1 bg-red-600 text-white text-xs rounded animate-pulse">NOTFALL</span>' : ''}
                                    </h2>
                                    
                                    ${app.uploadedImage ? `<img src="${app.uploadedImage}" class="w-full rounded mb-4">` : ''}
                                    
                                    <div class="space-y-4">
                                        ${disease?.prevalence ? `
                                            <div class="bg-gray-800 p-3 rounded border border-blue-700">
                                                <p class="text-xs text-blue-600 mb-1">PRÄVALENZ:</p>
                                                <p class="text-sm text-blue-300">${disease.prevalence}</p>
                                            </div>
                                        ` : ''}
                                        
                                        ${isVetMode ? `
                                            <!-- Wissenschaftliche Analyse -->
                                            <div class="bg-gray-800 p-4 rounded border border-cyan-700">
                                                <p class="text-xs text-cyan-600 mb-2">DIAGNOSE:</p>
                                                <p class="text-sm">${analysis?.diagnosis || 'Keine Daten'}</p>
                                            </div>
                                            <div class="bg-gray-800 p-4 rounded border border-cyan-700">
                                                <p class="text-xs text-cyan-600 mb-2">LABORWERTE:</p>
                                                <p class="text-sm font-mono">${analysis?.labValues || 'Keine Daten'}</p>
                                            </div>
                                            <div class="bg-gray-800 p-4 rounded border border-cyan-700">
                                                <p class="text-xs text-cyan-600 mb-2">BEHANDLUNG:</p>
                                                <p class="text-sm">${analysis?.treatment || 'Keine Daten'}</p>
                                            </div>
                                            <div class="bg-gray-800 p-4 rounded border border-cyan-700">
                                                <p class="text-xs text-cyan-600 mb-2">MEDIKATION:</p>
                                                <p class="text-sm font-mono">${analysis?.medication || 'Keine Daten'}</p>
                                            </div>
                                            <div class="bg-gray-800 p-4 rounded border border-cyan-700">
                                                <p class="text-xs text-cyan-600 mb-2">PROGNOSE:</p>
                                                <p class="text-sm">${analysis?.prognosis || 'Keine Daten'}</p>
                                            </div>
                                        ` : `
                                            <!-- Vereinfachte Erklärung -->
                                            <div class="bg-gray-800 p-4 rounded border border-cyan-700">
                                                <p class="text-xs text-cyan-600 mb-2">WAS IST PASSIERT?</p>
                                                <p class="text-sm">${analysis?.whatHappened || 'Keine Daten'}</p>
                                            </div>
                                            <div class="bg-gray-800 p-4 rounded border border-orange-700">
                                                <p class="text-xs text-orange-600 mb-2">WARUM IST DAS GEFÄHRLICH?</p>
                                                <p class="text-sm text-orange-300">${analysis?.whyDangerous || 'Keine Daten'}</p>
                                            </div>
                                            <div class="bg-gray-800 p-4 rounded border border-green-700">
                                                <p class="text-xs text-green-600 mb-2">WAS MUSS ICH TUN?</p>
                                                <ul class="text-sm text-green-300 space-y-1">
                                                    ${(analysis?.whatToDo || []).map(step => 
                                                        `<li>• ${step}</li>`
                                                    ).join('')}
                                                </ul>
                                            </div>
                                            <div class="bg-gray-800 p-4 rounded border border-blue-700">
                                                <p class="text-xs text-blue-600 mb-2">PRÄVENTION:</p>
                                                <p class="text-sm text-blue-300">${analysis?.prevention || 'Keine Daten'}</p>
                                            </div>
                                        `}
                                    </div>
                                </div>

                                <!-- Right: Vitals -->
                                <div class="space-y-4">
                                    <div class="bg-gray-900/60 backdrop-blur-md rounded-lg p-6 border border-cyan-800">
                                        <h3 class="text-lg font-bold mb-4">❤️ VITALPARAMETER</h3>
                                        
                                        <div class="space-y-3">
                                            ${Object.entries(app.vitals).map(([key, vital]) => {
                                                const labels = {
                                                    heartRate: '❤️ HERZFREQUENZ',
                                                    temperature: '🌡️ TEMPERATUR',
                                                    bloodPressure: '💉 BLUTDRUCK',
                                                    oxygenLevel: '💨 O₂ SÄTTIGUNG',
                                                    respirationRate: '🫁 ATEMFREQUENZ',
                                                    bloodGlucose: '🩸 BLUTZUCKER'
                                                };
                                                
                                                return `
                                                    <div class="bg-gray-800 p-3 rounded border ${
                                                        vital.status.level === 'normal' ? 'border-green-700' : 
                                                        vital.status.level === 'warnung' ? 'border-orange-700' : 
                                                        'border-red-700 urgency-critical'
                                                    } ${vital.status.bgColor} tooltip-trigger relative">
                                                        <div class="flex justify-between items-center">
                                                            <div>
                                                                <div class="text-xs text-gray-400">${labels[key]}</div>
                                                                <div class="text-xl font-bold ${vital.status.color}">
                                                                    ${vital.status.icon} ${vital.value} ${vital.unit}
                                                                </div>
                                                            </div>
                                                            <div class="text-right">
                                                                <div class="text-xs text-gray-500">Normal</div>
                                                                <div class="text-xs">${vital.normal.min}-${vital.normal.max}</div>
                                                            </div>
                                                        </div>
                                                        <div class="tooltip absolute left-0 top-full mt-2 p-2 bg-gray-900 rounded text-xs z-10 w-64">
                                                            ${vital.normal.description}
                                                        </div>
                                                    </div>
                                                `;
                                            }).join('')}
                                        </div>
                                    </div>
                                    
                                    <!-- XP Reward -->
                                    <div class="bg-gray-900/60 backdrop-blur-md rounded-lg p-4 border border-yellow-600">
                                        <div class="flex items-center justify-between">
                                            <span class="text-yellow-400 font-bold">XP ERHALTEN:</span>
                                            <span class="text-2xl text-yellow-400">+${app.careerSystem.experience - parseInt(localStorage.getItem('vetXP') || '0') + app.careerSystem.experience} XP</span>
                                        </div>
                                    </div>
                                    
                                    <!-- Actions -->
                                    <div class="flex gap-4">
                                        <button onclick="startNewCase()" class="flex-1 py-3 bg-cyan-600 hover:bg-cyan-500 text-gray-900 font-bold rounded">
                                            NEUER PATIENT
                                        </button>
                                        <button onclick="backToMenu()" class="flex-1 py-3 bg-gray-700 hover:bg-gray-600 text-white font-bold rounded">
                                            HAUPTMENÜ
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        // Event Handler
        function selectMode(mode) {
            app.mode = mode;
            render();
        }

        function startGame() {
            app.stage = 'input';
            render();
        }

        function backToMenu() {
            app.stage = 'menu';
            app.selectedDisease = '';
            app.uploadedImage = null;
            stopTimer();
            render();
        }

        function updateAnimalType(value) {
            app.selectedAnimalType = value;
            app.selectedDisease = ''; // Reset disease selection
            render(); // Re-render to update disease dropdown
        }

        function updateDisease(value) {
            app.selectedDisease = value;
            const disease = diseasesByAnimal[app.selectedAnimalType]?.[value];
            const urgencyWarning = document.getElementById('urgencyWarning');
            const diseaseInfo = document.getElementById('diseaseInfo');
            const diseasePrevalence = document.getElementById('diseasePrevalence');
            
            if (disease) {
                if (disease.urgency === 'NOTFALL') {
                    urgencyWarning.classList.remove('hidden');
                } else {
                    urgencyWarning.classList.add('hidden');
                }
                
                if (disease.prevalence) {
                    diseaseInfo.classList.remove('hidden');
                    diseasePrevalence.textContent = `Prävalenz: ${disease.prevalence}`;
                } else {
                    diseaseInfo.classList.add('hidden');
                }
            } else {
                urgencyWarning.classList.add('hidden');
                diseaseInfo.classList.add('hidden');
            }
            
            updateScanButton();
        }

        function handleImageUpload(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    app.uploadedImage = e.target.result;
                    document.getElementById('imagePreview').innerHTML = `
                        <img src="${e.target.result}" class="max-h-48 mx-auto rounded mb-2">
                        <p class="text-green-400 text-sm">✓ BILD ERFOLGREICH GELADEN</p>
                    `;
                    updateScanButton();
                };
                reader.readAsDataURL(file);
            }
        }

        function updateScanButton() {
            const btn = document.getElementById('scanBtn');
            if (app.selectedDisease && app.uploadedImage) {
                btn.disabled = false;
                btn.className = 'w-full py-4 rounded font-bold bg-cyan-600 hover:bg-cyan-500 text-gray-900 shadow-lg cursor-pointer transition-all transform hover:scale-105';
            } else {
                btn.disabled = true;
                btn.className = 'w-full py-4 rounded font-bold bg-gray-700 text-gray-500 cursor-not-allowed';
            }
        }

        function startScan() {
            if (app.selectedDisease && app.uploadedImage) {
                app.stage = 'scanning';
                app.scanProgress = 0;
                const disease = diseasesByAnimal[app.selectedAnimalType]?.[app.selectedDisease];
                
                if (disease?.urgency === 'NOTFALL') {
                    startTimer();
                }
                
                render();
            }
        }

        function startNewCase() {
            app.stage = 'input';
            app.selectedDisease = '';
            app.uploadedImage = null;
            app.scanProgress = 0;
            app.vitals = {};
            render();
        }

        // Initial render
        setTimeout(() => {
            render();
        }, 1500);
    </script>
</body>
</html>